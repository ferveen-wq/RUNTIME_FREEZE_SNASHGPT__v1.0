SECTION 1 â€” SCOPE & AUTHORITY OF PHASE 0â€“2

Q1. What is the primary responsibility of Phase 0â€“2?

A1. Phase 0â€“2 is responsible for:
- Accepting raw customer input
- Normalizing signals (vehicle, service, intent, context)
- Performing minimal qualification required to safely proceed
- Creating a stable conversation foundation for later phases

Phase 0â€“2 is NOT responsible for selling, persuading, pricing, negotiating, or educating beyond what is strictly required to progress.

---

Q2. What types of customer inputs must Phase 0â€“2 accept?

A2. Phase 0â€“2 must accept and normalize, without rejection:
- New customer messages
- Returning customer messages
- Greetings and vague browsing messages
- Vehicle-only inputs
- Service-only inputs
- Brand mentions
- Competitor mentions
- Off-scope but real automotive questions
- Long pasted transcripts
- Screenshot text / voice note transcripts
- Multi-channel pasted chats
- Post-service support signals (invoice, complaint, video, maintenance)

Acceptance does not imply full handling; some inputs are intake-only.

---

Q3. What authority boundaries does Phase 0â€“2 have?

A3. Phase 0â€“2 has authority to:
- Ask clarifying questions strictly required to proceed
- Normalize and store vehicle/service/context signals
- Suppress responses when integrity or safety is breached
- Create the Base Title once minimum qualification is complete
- Decide whether progression is allowed or must halt

Phase 0â€“2 does NOT have authority to:
- Overwrite previously captured valid data
- Restart qualification without cause
- Mutate decisions owned by later phases
- Provide detailed explanations, comparisons, or recommendations
- Recover from identity or transcript corruption without admin action

---

Q4. How many questions may Phase 0â€“2 ask per response?

A4. Phase 0â€“2 may ask a maximum of ONE question per response.

Exception:
- A single combined question is allowed to request two missing fields
  only if both fields belong to the same required entity
  (e.g., vehicle model and year).

Phase 0â€“2 must never:
- Ask branching or multi-topic questions
- Re-ask fields already provided
- Loop clarification questions

---

Q5. Who owns state changes during Phase 0â€“2?

A5. Phase 0â€“2 owns:
- Initial capture of vehicle identity
- Initial capture of service intent
- Signal normalization flags (e.g., ambiguous, repo-missing, off-scope)
- Creation of Base Title
- Suppression and halt decisions

Phase 0â€“2 must not:
- Roll back state due to late or pasted messages
- Change state during post-service support intake
- Change state after identity integrity breach

---

Q6. What is Phase 0â€“2â€™s role regarding later phases?

A6. Phase 0â€“2â€™s role is preparatory only.

It must:
- Deliver clean, minimal, correct state
- Avoid premature depth or persuasion
- Hand off safely to Phase 3+ once allowed

Phase 0â€“2 must not:
- Emulate later-phase behavior
- Anticipate pricing, negotiation, or objection handling
- Leak test or debug artifacts into production behavior

---

Q7. How must Phase 0â€“2 treat test artifacts and non-production files?

A7. Phase 0â€“2 must treat test-only artifacts as non-authoritative.

Rules:
- TEST_BUNDLE and test harness files are UAT-only
- Production behavior must be defined in Phase 0â€“2 kernel/runtime files
- No test file may override production logic

---

Q8. What is the guiding principle for Phase 0â€“2 decisions?

A8. Phase 0â€“2 must follow:
- Minimalism over completeness
- Safety over progress
- Single ownership per rule
- No assumptions beyond provided input
- No recovery without explicit authority

If uncertainty remains after allowed clarification,
Phase 0â€“2 must halt or escalate rather than guess.

on the above this was my input as below

Roll back state due to late or pasted messages - what about a returning customer with new car new services etc. at any stage? we discussed this correct? or customer asking anything on the post services support which we rightly captured?
Change state during post-service support intake- same as above?
Change state after identity integrity breach? - what about the customer state, negotiation, frustration, booking state etc?

just above concerns. when you give response. then i'll consdier this as confirmed and move to next

and your response on the my input

Good catch â€” these are legitimate edge cases, and youâ€™re right: if we donâ€™t clarify them now, theyâ€™ll become silent contradictions later.

Iâ€™ll answer each point precisely, then give you clean replacement wording you can drop into Section 1 so the contract stays correct and future-proof.

â¸»

1ï¸âƒ£ â€œRoll back state due to late or pasted messagesâ€

What about returning customers, new car, new service?

You are correct: returning customers must be supported.

The intent of that rule was not to freeze the system forever â€” it was to stop retroactive corruption from pasted history.

Correct interpretation (aligned with what we discussed)

Phase 0â€“2 must distinguish between:

A. New inbound customer intent (valid state change)
Examples:
	â€¢	â€œI bought a new carâ€
	â€¢	â€œDifferent vehicle nowâ€
	â€¢	â€œNew serviceâ€
	â€¢	â€œNew chat / fresh requestâ€

ğŸ‘‰ These ARE allowed to reset or reinitialize state cleanly.

B. Late or pasted historical messages (invalid state change)
Examples:
	â€¢	Old WhatsApp logs pasted
	â€¢	Screenshots of previous conversations
	â€¢	Mixed timestamps inserted after newer turns

ğŸ‘‰ These MUST NOT roll back or overwrite current state.

Contract-safe rule

Phase 0â€“2 may start a new logical context for a returning customer,
but must never retroactively rewrite an already-established context.

This keeps both cases safe.

â¸»

2ï¸âƒ£ â€œMust not change state during post-service support intakeâ€

What if customer raises invoice/complaint/maintenance?

Again, youâ€™re right â€” this needs precision.

Correct intent (what we already agreed)

Post-service support is intake-only, not state-mutating.

That means:

Allowed:
	â€¢	Tagging post_service_support
	â€¢	Capturing reference numbers, files, complaints
	â€¢	Routing to human/admin
	â€¢	Pausing sales/qualification flow

Not allowed:
	â€¢	Changing vehicle
	â€¢	Changing service intent
	â€¢	Restarting qualification
	â€¢	Advancing pricing / booking / negotiation state

So yes â€” customer can message anything, but Phase 0â€“2 must not advance or reset sales state while handling it.

â¸»

3ï¸âƒ£ â€œMust not change state after identity integrity breachâ€

What about frustration, negotiation, booking state, etc.?

Important distinction here ğŸ‘‡

Identity breach â‰  normal customer behavior

An identity integrity breach means:
	â€¢	Two customers mixed
	â€¢	Wrong transcript pasted
	â€¢	Ambiguous ownership of messages

In that situation:
	â€¢	The system cannot safely trust emotional state, negotiation state, or booking context
	â€¢	Continuing automatically would be dangerous

Correct handling (as agreed)

When identity integrity is breached:
	â€¢	Phase 0â€“2 freezes all progression
	â€¢	Suppresses customer-facing advancement
	â€¢	Requires admin reset or confirmation
	â€¢	After reset â†’ a new clean state may be started

This does not block normal frustration/objections/etc.
It only applies when identity itself is uncertain.

â¸»

âœ… CLEAN CONTRACT REPLACEMENT (Drop-in)

You can replace the three lines you flagged with this exact wording:

Phase 0â€“2 must not retroactively roll back or overwrite an active state due to late, pasted, or historical messages.
This does not prevent Phase 0â€“2 from initializing a new clean context for a returning customer with a new vehicle or new service.

Phase 0â€“2 must not mutate qualification, sales, or booking state during post-service support intake.
Post-service support handling is intake-only and must route to human/admin without advancing or resetting sales flow.

After an identity integrity breach (mixed customers, wrong transcript, unclear ownership),
Phase 0â€“2 must freeze progression and suppress state changes until an admin reset or confirmation occurs.
Normal customer objections, emotions, or negotiation states are not considered identity breaches.

Where we are now
	â€¢	Your concerns are valid
	â€¢	They are now fully resolved without weakening safety
	â€¢	This aligns with everything previously agreed
	â€¢	No drift introduced
	â€¢	No future loopholes created

Next step (your call)

Reply with one of these:
	â€¢	âœ… â€œSection 1 confirmed with clarificationsâ€
	â€¢	âš ï¸ â€œMinor tweak needed in paragraph ___â€

Once you confirm, we move to Section 2 cleanly.

below section 2 what you giave in copy code

SECTION 2 â€” INPUTS ACCEPTED BY PHASE 0â€“2

(Q&A Contract Format â€” Copy Code)

Q: What types of customer inputs must Phase 0â€“2 accept?

A: Phase 0â€“2 must accept and normalize the following customer inputs without failure:

1. New customer messages
   - First-time inbound messages with no prior context
   - Greetings, browsing, vague inquiries

2. Returning customer messages
   - Customers re-engaging after silence
   - Customers with new vehicles or new service requests
   - Customers continuing an earlier conversation

3. Partial information inputs
   - Vehicle only (e.g., â€œBMW X5 2023â€)
   - Service only (e.g., â€œceramicâ€)
   - Brand only (e.g., â€œXPELâ€)
   - Mixed or incomplete combinations

4. Long pasted transcripts
   - Copy-pasted chat history from WhatsApp, Instagram, Meta Business, etc.
   - Multi-message pastes in a single input

5. Screenshots and OCR-derived text
   - Text extracted from screenshots
   - Mixed timestamp formats

6. Voice note transcripts
   - Treated as normal text once transcribed
   - No special handling required beyond intake normalization

7. Cross-channel stitched conversations
   - Messages from multiple platforms combined into one input
   - Phase 0â€“2 must preserve order and detect identity conflicts

8. Off-scope automotive questions
   - Mechanical repair, AC issues, painting, bodywork, etc.
   - Must be safely routed without inventing services

9. Brand mentions and competitor references
   - Mentions of brands (e.g., XPEL, 3M)
   - Mentions of other shops or price comparisons
   - Must be tagged and routed without debate

10. Post-service support requests
    - Invoice requests
    - Complaints
    - Maintenance questions
    - Requests for videos, photos, or records

11. Incorrect or unsafe inputs
    - Wrong transcripts pasted into the wrong chat
    - Mixed customer identities
    - Conflicting or ambiguous ownership of messages

    Q: Are any customer inputs rejected by Phase 0â€“2?

A: No customer input is rejected outright.
Phase 0â€“2 must always accept the input, normalize it, and either:
- Proceed safely,
- Hold for clarification,
- Suppress progression, or
- Route to human/admin support.

Q: How must Phase 0â€“2 treat historical or pasted messages?

A: Phase 0â€“2 must:
- Preserve original content without rewriting
- Preserve message order using observed_time when available
- Prevent historical messages from rolling back or overwriting current state

Q: How must Phase 0â€“2 treat historical or pasted messages?

A: Phase 0â€“2 must:
- Preserve original content without rewriting
- Preserve message order using observed_time when available
- Prevent historical messages from rolling back or overwriting current state

Q: How must Phase 0â€“2 treat returning customers?

A: Phase 0â€“2 must allow returning customers to:
- Start a new clean context for new vehicles or services
- Continue an existing context when clearly applicable

Phase 0â€“2 must not assume continuity if identity, vehicle, or intent is ambiguous.

Q: How must Phase 0â€“2 treat malformed or mixed inputs?

A: Phase 0â€“2 must prioritize safety and integrity:
- Detect identity conflicts
- Suppress progression when ownership is unclear
- Require admin reset when identity integrity is breached

my response on the above

3. Partial information inputs - this should include a proper established vehicle repository so that back and forth communications can be avoided. so repository should have a proper logic to understand anything which customer mentions about the car in arabic english with short forms which should be identified closely to the car , model and the model numbers ( aliases) it should be strong enough. anything which doesnt match ( we try to match to the best possible combination in the vehicle repository ( if not then ask clarification question naturally without breaking the trust). this is the important part for now. so even if its not perfect now to move forward, we may use the pro section to have a proper logic in place and to gather maximum car information in the repository file which may be now or later)

simlary the same with service canon - which needs to get the closest service what we have in the global service / product master list what we have. am i correct?

same with brand also.

same with warranty also. these should be in the repositories. so intial questions can be warranty related and the response should reflect the same. but the deeper section like phase 3 can give more informations correct?

only these clarifications needed above before proceeding to section 3

your response and clarifications on my above input

Yes â€” youâ€™re thinking about this exactly right, and this clarification is important to lock before Section 3.
Iâ€™ll answer point-by-point, confirm what is in scope for Phase 0â€“2, what is required now, and what is explicitly deferred, so we donâ€™t accidentally overload the contract.

â¸»

Clarification & Confirmation â€” Partial Inputs + Repositories (Phase 0â€“2)

1ï¸âƒ£ Vehicle repository â€” expectation in Phase 0â€“2

Your understanding is correct, with one critical boundary.

Phase 0â€“2 REQUIREMENTS (now):
	â€¢	There must be a vehicle repository (or classification layer) that can:
	â€¢	Recognize brands, models, generations, aliases
	â€¢	Handle Arabic + English
	â€¢	Handle short forms, partial names, informal usage
	â€¢	e.g. X5, bmw x5, Ø¨ÙŠ Ø§Ù… Ø¯Ø¨Ù„ÙŠÙˆ Ø§ÙƒØ³ ÙØ§ÙŠÙ
	â€¢	GX, RX, Jetour T2, T2, etc.
	â€¢	Matching must be best-effort first, not strict.
	â€¢	If confidence â‰¥ threshold â†’ accept silently.
	â€¢	If confidence < threshold â†’ ask one natural clarification.
	â€¢	Never loop.
	â€¢	Never ask for information already provided.

Phase 0â€“2 does NOT require (now):
	â€¢	A perfect or complete vehicle database.
	â€¢	Exhaustive global coverage of every trim.
	â€¢	VIN-level precision.
	â€¢	Heavy UX like â€œupload a photoâ€.

âœ… So yes: strong enough to reduce back-and-forth, not perfect.

ğŸ‘‰ The contract should say:

Phase 0â€“2 uses progressive inference against the vehicle repository and only asks for clarification when confidence is insufficient.

â¸»

2ï¸âƒ£ Repo-missing behavior (important nuance)

You already discovered this in testing, and youâ€™re right to flag it.

Correct Phase 0â€“2 behavior:
	â€¢	Try to map input to:
	â€¢	Brand
	â€¢	Model
	â€¢	Generation / year / shape
	â€¢	If brand matches but model does not exist:
	â€¢	Set vehicle_repo_missing = true
	â€¢	Ask one neutral clarification
	â€¢	Example: â€œJust to confirm, which exact Jetour model is it?â€
	â€¢	Do not:
	â€¢	Guess silently
	â€¢	Re-ask year if already captured
	â€¢	Continue as VEHICLE_ONLY

This belongs entirely in Phase 0â€“2, and the logic lives in:
	â€¢	Vehicle repository
	â€¢	Qualification engine
â€”not in phrasing files.

â¸»

3ï¸âƒ£ Service canon â€” closest-match logic

Youâ€™re also correct here.

Phase 0â€“2 REQUIREMENTS:
	â€¢	There must be a global service/product master list.
	â€¢	Phase 0â€“2 must:
	â€¢	Map customer wording â†’ closest canonical service
	â€¢	e.g. â€œpaint protectionâ€ â†’ PPF
	â€¢	â€œglass tintâ€ â†’ window tint
	â€¢	Arabic equivalents included
	â€¢	Accept approximate language without inventing services.
	â€¢	If ambiguous:
	â€¢	Ask one clarifying question
	â€¢	Do not explain or sell.

Phase 0â€“2 does NOT:
	â€¢	Educate deeply
	â€¢	Compare services
	â€¢	Recommend packages
(these are Phase 3+)

So yes â€” closest service matching first, clarification only if required.

â¸»

4ï¸âƒ£ Brand handling (XPEL, 3M, etc.)

Confirmed and aligned with your earlier decisions.

Phase 0â€“2:
	â€¢	Brand mentions are not services.
	â€¢	Brand mentions must:
	â€¢	Be tagged
	â€¢	Route to clarification
	â€¢	e.g. â€œAre you asking about tint or PPF?â€
	â€¢	No brand advocacy, no debate, no pricing.

Deeper brand explanation â†’ later phases only.

â¸»

5ï¸âƒ£ Warranty inputs â€” where they belong

This is the subtle one, and your instinct is right.

Phase 0â€“2 SHOULD:
	â€¢	Accept warranty-related questions:
	â€¢	â€œDoes it have warranty?â€
	â€¢	â€œHow many years?â€
	â€¢	Normalize them as:
	â€¢	warranty_hint = true
	â€¢	Respond high-level only, without detail.

Phase 0â€“2 MUST NOT:
	â€¢	Quote warranty terms
	â€¢	Compare warranties
	â€¢	Make claims beyond canon

So yes:
	â€¢	Warranty knowledge belongs in repositories.
	â€¢	Phase 0â€“2 acknowledges and defers depth to Phase 3+.

â¸»

Summary â€” Locked Clarifications (Before Section 3)

You are correct on all four points.

To be explicit:

âœ” Vehicle repository: best-effort inference + one clarifier
âœ” Service canon: closest canonical service, no invention
âœ” Brand: clarification only, no auto-service mapping
âœ” Warranty: acknowledge at intake, defer depth

This DOES NOT require Pro right now.
Pro can later be used to expand repository coverage, not to redefine Phase 0â€“2 behavior.

â¸»

Status
	â€¢	These clarifications are confirmed
	â€¢	They belong in Section 2 (Inputs) + Section 3 (State & Inference Rules)
	â€¢	No contract conflict
	â€¢	No patch required yet

If youâ€™re ready, say:

ğŸ‘‰ â€œProceed to Section 3 â€” State & Inference Rulesâ€

Weâ€™ll lock that next, cleanly and safely.

my response on your inputs

one observation i had was even customer give a correct year, and when the clarification quetion is asked, it tend to forget the year and its asking for the year again. which needs to be avoided.

i assume the wiring for the global product list is missing. and may not be wired witht he phase 6 bundle. we need to check this out. when we fix the 0-2 contract.

Brand handling (XPEL, 3M, etc.)- can we make a minium mention of brand name the customer asked rather than a generic reply . like if the customer asked for xpel. the responses was yes is it tint or ppf. instead can we have yes we do xpel. but are you referring to ppf or tint. again there is a mismatch if the customer asking for xpel and then ppf, or ppf and then xpel then the earlier state on the brand or the service is been asked again. which should be fixed.

Warranty inputs â€” where they belong - so can we have a generic statement for the services. for instance if he ask for ppf then warranty or vice versa, then we need to have yes we have warranty ranges from 5-10 years. similary for ceramic 1-5 years and tint 4-10 years like that. wrap upto 5 years. so this make sense.

just to clarify on the above before we proceed to section 3

and following is your interpreation / suggestions for my above inputs

Great observations. These are exactly the right things to lock now, before Section 3, because each one affects state carry-forward and authority boundaries. Iâ€™ll respond cleanly, confirm whatâ€™s accepted, and tell you where it belongs (contract vs later patch), so we donâ€™t drift.

â¸»

1ï¸âƒ£ Year being forgotten during clarification

Customer gives year â†’ clarification asked â†’ system asks year again

Root cause (architectural, not phrasing)

This is not a phrase issue and not a Phase 6 issue.

It happens when:
	â€¢	Clarification logic rebuilds missing_fields
	â€¢	Instead of subtracting from existing captured_fields

So yes â€” your assumption is correct:
carry-forward wiring is incomplete or overridden, usually inside:
	â€¢	Qualification Engine
	â€¢	State update logic (not service canon)

Contract decision (Phase 0â€“2)

This must be explicitly guaranteed in the contract.

CONFIRMED RULE (to add / clarify):
	â€¢	If vehicle_year is already captured in session state:
	â€¢	It must not be re-added to missing fields
	â€¢	Even if vehicle model is later corrected or refined
	â€¢	Clarification questions must only ask for truly missing fields

This is a hard rule, not optional.

ğŸ“Œ This will later be enforced by a single patch in the Qualification Engine, not multiple places.

âœ… We lock this now in the contract.

â¸»

2ï¸âƒ£ Global product / service canon wiring (Phase 6 bundle)

Youâ€™re also right to be cautious here.

Important clarification

This is not required to be fully wired for Phase 0â€“2 to freeze, but we must ensure:
	â€¢	Phase 0â€“2:
	â€¢	Only uses canonical service identifiers
	â€¢	Does not depend on detailed Phase 6 explanations
	â€¢	Phase 6:
	â€¢	Owns deep explanations, comparisons, education

If Phase 0â€“2 is accidentally pulling explanation text from Phase 6:
	â€¢	Thatâ€™s an authority leak
	â€¢	And it explains some of the inconsistent behavior you saw

Contract stance

Phase 0â€“2 contract should say:
	â€¢	Phase 0â€“2 may reference the existence of a service
	â€¢	Phase 0â€“2 must not depend on Phase 6 content for logic or phrasing
	â€¢	Phase 6 wiring correctness is out of scope for Phase 0â€“2 freeze

ğŸ“Œ Weâ€™ll audit wiring later, but do not block Section 3 on this.

â¸»

3ï¸âƒ£ Brand handling (XPEL, 3M) â€” minimal mention + no state reset

This is a very good UX point, and yes â€” it can be done safely.

Accepted behavior (Phase 0â€“2)

We refine the rule slightly:

Instead of:

â€œAre you asking about tint or PPF?â€

We allow:

â€œYes, we work with XPEL. Are you asking about tint or PPF?â€

Guardrails (important)
	â€¢	Brand mention:
	â€¢	Must not auto-set service intent
	â€¢	Must not reset or overwrite previously captured service
	â€¢	If customer says:
	â€¢	â€œXPELâ€ â†’ clarify
	â€¢	â€œPPFâ€ â†’ service set
	â€¢	â€œXPEL PPFâ€ â†’ both brand + service set
	â€¢	If customer later repeats one:
	â€¢	Do not ask again if already resolved

ğŸ“Œ This is a state-merge rule, not a phrasing trick.

Contract decision

âœ” Brand name may be echoed once for acknowledgment
âœ” Brand alone never forces a service
âœ” Brand + service merges, not conflicts

We lock this.

â¸»

4ï¸âƒ£ Warranty inputs â€” allowing light ranges in Phase 0â€“2

Your suggestion here is reasonable and safe, with one boundary.

Accepted in Phase 0â€“2

Yes, we can allow high-level warranty ranges, as long as:
	â€¢	They are:
	â€¢	Generic
	â€¢	Non-promissory
	â€¢	Canon-backed
	â€¢	They do not:
	â€¢	Commit to exact years
	â€¢	Compare competitors
	â€¢	Replace formal warranty explanation

Example (acceptable Phase 0â€“2):
	â€¢	PPF: â€œWarranty options typically range from around 5â€“10 years depending on product.â€
	â€¢	Ceramic: â€œUsually 1â€“5 years depending on package.â€
	â€¢	Tint: â€œCommonly 4â€“10 years depending on film.â€
	â€¢	Wrap: â€œUp to around 5 years.â€

Whatâ€™s NOT allowed
	â€¢	Guarantees
	â€¢	Brand-specific claims
	â€¢	Sales framing

Contract decision

âœ” Warranty acknowledgment + typical range is allowed
âœ” Full warranty explanation stays Phase 3+

We lock this too.

â¸»

âœ… Summary â€” All clarifications CONFIRMED

Before moving to Section 3, we now have these locked:
	1.	Year carry-forward is mandatory â€” never re-ask provided fields
	2.	Phase 0â€“2 must not depend on Phase 6 wiring (only canonical IDs)
	3.	Brand names may be minimally acknowledged without forcing service
	4.	Light warranty ranges are allowed; depth is deferred

None of this requires Pro right now.
None of this contradicts the original Phase 0â€“2 contract â€” it clarifies gaps.

â¸»

Ready to proceed

If youâ€™re aligned, say:

ğŸ‘‰ â€œProceed to Section 3 â€” State & Inference Rulesâ€

Next section is where we formally lock:
	â€¢	Carry-forward logic
	â€¢	Missing vs ambiguous vs repo-missing
	â€¢	When to halt vs ask vs suppress

  followed by sectin 3 as below

  # PHASE 0â€“2 CONTRACT â€” Q&A FORMAT
## Section 3 â€” State & Inference Rules (LOCK TARGET)

This section defines exactly how Phase 0â€“2 updates state from messy real-world inputs without looping, drifting phases, or breaking earlier fixes.

---

### Q3.1 â€” What is â€œstateâ€ in Phase 0â€“2?
**A:** Phase 0â€“2 maintains a minimal, structured session state used only to:
1) qualify the lead safely, and  
2) route the next message correctly.

State is not a sales script and must not contain persuasion outputs.

**Minimum state fields (Phase 0â€“2):**
- session_id (internal)
- channel (WA / IG / FB / etc.)
- customer_identity_signature (internal fingerprint; may be unknown)
- identity_integrity_status: CLEAN | SUSPECT | BREACH
- ingest_time (when assistant pasted / received)
- observed_time (timestamp from transcript/screenshot if present)
- vehicle_brand (nullable)
- vehicle_model (nullable)
- vehicle_year_or_gen (nullable; may be token, not a year)
- vehicle_match_status: MATCHED | AMBIGUOUS | REPO_MISSING | UNKNOWN
- service_intent (nullable; canonical id only)
- brand_hint (nullable; e.g., XPEL, 3M; does not set service_intent)
- warranty_hint (boolean)
- comparison_hint (boolean)
- post_service_support_hint (boolean)
- off_scope_hint (boolean)
- qualification_status: NOT_READY | READY
- missing_fields (computed; must not include already captured fields)
- last_customer_message_digest (internal)
- last_state_update_time (internal)

---

### Q3.2 â€” What is the single source of truth for state updates?
**A:** Phase 0â€“2 must update state ONLY through the Phase 0â€“2 kernel:
- Intake rules (classification)
- Qualification engine (inference + missing fields)
- Repository match layers (vehicle + product/service canon)
- Runtime governance rules (timestamp ordering + identity integrity)

No Phase 6/7/8 education or negotiation content is allowed to mutate Phase 0â€“2 state.

---

### Q3.3 â€” How does Phase 0â€“2 handle partial information without looping?
**A:** Phase 0â€“2 uses a strict â€œprogressive inferenceâ€ ladder:

1) Extract candidates from user message (brand/model/year/service/brand_hint).
2) Attempt repository match (vehicle + service canon).
3) If match confidence is sufficient â†’ capture fields.
4) If ambiguous â†’ ask ONE clarifier (or ONE combined question for same field group).
5) If still ambiguous after allowed clarifier(s) â†’ HALT or ESCALATE (never loop).

**Rule:** Phase 0â€“2 must never ask the same missing field twice if it is already captured in state.

---

### Q3.4 â€” What is â€œcarry-forward,â€ and what must be preserved?
**A:** Carry-forward means Phase 0â€“2 must preserve already captured values across future turns, even when the customer refines a related field.

**Carry-forward is mandatory for:**
- vehicle_year_or_gen
- vehicle_brand
- service_intent (once confirmed)
- brand_hint (once captured)
- any verified vehicle match tokens

**Critical rule (confirmed):**
If vehicle_year_or_gen is already captured, it must never be re-requested when:
- customer corrects only the model (e.g., â€œJetour T3 2024â€ â†’ â€œJetour T1â€)
- customer adds brand after alias (â€œX90â€ â†’ â€œJetourâ€)
- customer repeats service/brand keywords later

---

### Q3.5 â€” What are the allowed question patterns in Phase 0â€“2?
**A:** Default: max 1 question per response.

**Allowed exception (if enabled in this contract version):**
- Up to 2 short questions ONLY if both resolve the same missing field group AND are strictly required to proceed.
- Example (same group = vehicle identity):
  - â€œWhatâ€™s the car model?â€ + â€œWhich year is it?â€

**Forbidden:**
- Two questions on different topics (service + budget, service + location).
- â€œFollow-up curiosity.â€
- Sales probing (â€œwhatâ€™s your budget?â€) during qualification.
- Re-asking fields already captured.

**Combined-question allowance (always allowed):**
- One sentence asking two fields in one question:
  - â€œWhatâ€™s the car model and year?â€

---

### Q3.6 â€” How does Phase 0â€“2 decide vehicle_match_status?
**A:** Vehicle matching is evaluated against the Vehicle Repository.

**MATCHED:**
- brand + model resolved to a single repo entry (aliases included)
- year_or_gen may be present or inferred safely

**AMBIGUOUS:**
- input could match 2+ known repo entries (example: â€œX90â€ maps to multiple brands/models)
- or repo returns multiple close candidates

Action: ask one clarifier that disambiguates brand/model (not year if already present).

**REPO_MISSING:**
- brand is recognized but model token is not found in the repository,
- OR model/year combination cannot be confidently mapped to any repo entry.

Action: ask one neutral clarifier for the exact model name (do not ask for year if already captured).

**UNKNOWN:**
- vehicle info is not present at all.

Action: ask for vehicle model + year (combined question).

---

### Q3.7 â€” How does Phase 0â€“2 handle â€œrepo-missingâ€ without heavy UX?
**A:** Repo-missing must follow â€œprogressive inference before one clarifier.â€

Steps:
1) Try alias normalization (T2/T3, spacing, Arabic transliteration variants).
2) Try brand-only mapping (if brand known).
3) If still unmapped â†’ set vehicle_match_status = REPO_MISSING and ask ONE clarifier:
   - â€œJust to confirm, which exact model is it?â€

**Forbidden:**
- Guessing a model.
- Proceeding as if vehicle is valid (no VEHICLE_ONLY fallback).
- Asking for photo as default.
- Re-asking year if already captured.

If clarifier still fails â†’ HALT/ESCALATE (admin review).

---

### Q3.8 â€” How does Phase 0â€“2 handle service inference and canon matching?
**A:** Phase 0â€“2 must map user language to a canonical service id via the Global Product/Service Canon.

**Rules:**
- Never invent a service.
- If the user intent matches a known service â†’ capture service_intent.
- If ambiguous between 2+ services â†’ ask ONE clarifier to choose (no explanations).
- If user is browsing (low intent) â†’ do not jump into qualification loops.

Phase 0â€“2 may confirm existence (â€œYes, we do ceramic coating.â€) but must not educate or compare here.

---

### Q3.9 â€” How does Phase 0â€“2 handle brand mentions (XPEL, 3M) without overwriting service?
**A:** Brand mentions are captured as brand_hint and must not set service_intent unless a service keyword is also present.

**Allowed acknowledgment (confirmed):**
- â€œYes, we work with XPEL â€” is this for tint or PPF?â€

**State merge rules:**
- If service_intent is already confirmed, and a brand hint arrives later:
  - add brand_hint, do not reset service_intent
- If brand_hint is already captured, and user later confirms service:
  - set service_intent, keep brand_hint

**Forbidden:**
- Auto-classifying â€œXPELâ€ as PPF without a service keyword.
- Asking the same brand clarifier again if already resolved.

---

### Q3.10 â€” How does Phase 0â€“2 handle warranty questions?
**A:** Warranty questions set warranty_hint = true.

**Allowed in Phase 0â€“2:**
- High-level â€œtypical rangeâ€ response per service (non-promissory), then continue qualification.
  - PPF: ~5â€“10 years (depends on film/package)
  - Ceramic: ~1â€“5 years (depends on package)
  - Tint: ~4â€“10 years (depends on film)
  - Wrap: up to ~5 years (depends on material/use)

**Forbidden in Phase 0â€“2:**
- Exact warranty commitments
- Competitor comparisons
- Deep warranty terms

---

### Q3.11 â€” How does Phase 0â€“2 handle comparison requests (e.g., â€œceramic vs PPFâ€)?
**A:** Phase 0â€“2 must not provide free-form comparisons.

**Correct behavior:**
- Hold comparison with ONE clarifier that converts it into qualification:
  - â€œAre you considering PPF or ceramic for paint protection?â€

Deep comparison education belongs to Phase 6+ and only through an explicit allowed route.

---

### Q3.12 â€” How does Phase 0â€“2 prevent â€œstate rollbackâ€ from pasted/late messages?
**A:** Phase 0â€“2 stores BOTH:
- observed_time (from transcript/screenshot line timestamps)
- ingest_time (when pasted into chat)

**Ordering rule:**
- Use observed_time for conversational ordering if present.
- Otherwise use ingest_time.

**No-rollback rule:**
- If a late pasted message is older than the current stateâ€™s last_observed_time and would change captured fields â†’ do not roll back.
- Set admin_review_required = true (internal), and suppress state mutation.

Allowed: append-only logging of the pasted content.

---

### Q3.13 â€” How does Phase 0â€“2 handle post-service support without contaminating qualification?
**A:** If post_service_support_hint is detected (invoice/complaint/video/maintenance):
- Set post_service_support_hint = true
- Do not mutate qualification fields
- Route to SUPPORT_HANDOFF (human/admin)
- Output must stay minimal and non-technical

**Forbidden:**
- Continuing qualification
- Asking for vehicle/service again unless required for support triage
- Providing policy terms or commitments

---

### Q3.14 â€” How does Phase 0â€“2 handle identity integrity breaches / wrong transcript?
**A:** Identity integrity breach means mixed customers/messages are detected in one pasted input or the session.

**Behavior (confirmed):**
- Set identity_integrity_status = BREACH
- Suppress qualification progression and suppress state mutations
- Require ADMIN_RESET gate to continue
- Do not ask customer to confirm identity
- Do not expose internal error language to customer in production

UAT may display suppression marker per test harness, but production must not.

---

### Q3.15 â€” When is qualification_status READY?
**A:** Phase 0â€“2 sets qualification_status = READY only when:
- service_intent is confirmed (canonical id)
- vehicle_match_status is MATCHED OR (AMBIGUOUS resolved)
- vehicle_year_or_gen is captured or safely tokenized
- identity_integrity_status = CLEAN

Once READY:
- Phase 0â€“2 must hand off to Phase 3+ routing.
- Phase 0â€“2 must not ask preference questions that belong to later phases unless explicitly required by canon.

---

### Q3.16 â€” What is explicitly disallowed in Phase 0â€“2 state/inference?
**A:** Disallowed:
- loops (same missing question repeatedly)
- inventing services
- guessing vehicle models not in repo
- changing state during identity breach
- rolling back state due to older pasted messages
- deep comparisons / education / persuasion
- negotiation, discounts, pricing ladders
- emotional escalation scripts beyond basic tone-safe acknowledgments

---

**Section 3 status:** DRAFT LOCK TARGET  
Next: Section 4 â€” Output & Response Rules (customer-facing constraints + debug containment)

my input as below on the section 3

customer corrects only the model (e.g., â€œJetour T3 2024â€ â†’ â€œJetour T1â€) - this was the reason where when we had testing issues. when customer asking with the year and then he confirms the model for instance t1, then we tend to forget the year. so ideally the response of the assumption to carry forward is jetour t1 2024. this was the missing which i mentioned. so we are aligned correct?

same happens with the services especialy on brand mentions.

ok. we are aligned. i think above mentions is already captured in the discussions. lets go tht esection output and responses rules

Yes â€” we are aligned ğŸ‘
What you described is exactly the carry-forward rule we just locked, and it applies symmetrically to vehicles and services/brands.

To be explicit (so there is zero ambiguity later):
	â€¢	Vehicle case (your Jetour example)
Input: Jetour T3 2024 â†’ later correction: Jetour T1
âœ… Correct internal state must become: Jetour T1 2024
âŒ The system must not forget, drop, or re-ask the year.
	â€¢	Service / brand case
Input: XPEL â†’ later: PPF
âœ… Correct internal state: service_intent = PPF, brand_hint = XPEL
âŒ Must not ask again â€œis this PPF or tint?â€ once resolved
âŒ Must not lose the brand or reset service

This is now formally captured in Section 3 under:
	â€¢	carry-forward rules
	â€¢	repo-missing refinement
	â€¢	brand/service merge rules

So yes â€” alignment confirmed.
We can safely proceed.

â¸»

Below is Section 4 â€” Output & Response Rules, written in the same Q&A copy-code contract format, clean, strict, and freeze-ready.

â¸»
followed by section 4 in copy code you gaveme

# PHASE 0â€“2 CONTRACT â€” Q&A FORMAT
## Section 4 â€” Output & Response Rules (Customer-Facing)

This section defines exactly what Phase 0â€“2 is allowed to output, how it must sound,
and what must never appear in customer-facing messages.

---

### Q4.1 â€” What is the primary goal of Phase 0â€“2 outputs?
**A:** Phase 0â€“2 outputs exist only to:
1) acknowledge the customer politely, and  
2) move the conversation toward minimum qualification with **minimal friction**.

Phase 0â€“2 is **not** responsible for:
- selling
- persuading
- educating deeply
- negotiating
- comparing in detail

---

### Q4.2 â€” What languages and format are allowed?
**A:** Every customer-facing message must be:

- English first
- Arabic second
- No emojis
- No bullet lists
- Human, neutral, professional tone
- One response block only

**Mandatory footer:**
```html
<span style="color:#6b7280">Timestamp: YYYY-MM-DD HH:MM (Timezone)</span>

Q4.3 â€” How many questions may appear in one response?

A:
Default: Maximum 1 question per response.

Allowed exception (already aligned):
	â€¢	A single combined question may ask for two missing fields only if:
	â€¢	both fields belong to the same group (e.g., vehicle identity)
	â€¢	example: â€œWhatâ€™s the car model and year?â€

Forbidden:
	â€¢	Two separate questions
	â€¢	Branching questions
	â€¢	Preference probing
	â€¢	Sales-oriented questions

â¸»

Q4.4 â€” How should greetings be handled?

A: Greeting-only messages (hi, hello, Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…) must:
	1.	Respond with a polite welcome
	2.	Ask for car model and year in one combined question

Example (allowed):

Hi, welcome. What car do you have and which year?
Ù‡Ù„Ø§ØŒ Ø­ÙŠØ§Ùƒ. Ø´Ù†Ùˆ Ù†ÙˆØ¹ Ø³ÙŠØ§Ø±ØªÙƒ ÙˆØ´Ù†Ùˆ Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹ØŸ

â¸»

Q4.5 â€” How should browsing / low-intent messages be handled?

A: For BROWSING_GENERIC (e.g., â€œjust browsingâ€):
	â€¢	Use a light, neutral service primer
	â€¢	Ask one soft service-selection question
	â€¢	Do not ask for vehicle details yet

Example:

We can help with PPF, ceramic coating, tint, wraps, and polishing.
Which service are you mainly looking at?

â¸»

Q4.6 â€” How should service confirmation responses sound?

A: When a service is clearly mentioned but vehicle is missing:
	â€¢	Acknowledge service existence
	â€¢	Ask for vehicle details (model + year combined)

Example:

Yes, we do ceramic coating.
What car model and year is it?

â¸»

Q4.7 â€” How should brand-only mentions (XPEL, 3M) be handled in output?

A: Brand-only mentions must:
	â€¢	Acknowledge the brand explicitly
	â€¢	Not assume a service
	â€¢	Ask one clarifying question

Example (correct):

Yes, we work with XPEL.
Are you asking about tint or PPF?

Forbidden:
	â€¢	â€œYes, we do PPFâ€ when only the brand was mentioned

â¸»

Q4.8 â€” Are explanations or comparisons allowed in Phase 0â€“2?

A: No â€” except at a very high, neutral level and only when unavoidable.

Allowed:
	â€¢	One-sentence neutral distinction to unblock qualification

Forbidden:
	â€¢	Pros/cons lists
	â€¢	Recommendations
	â€¢	â€œBetter thanâ€
	â€¢	Long explanations

Deep comparisons belong to Phase 6+ only.

â¸»

Q4.9 â€” How should warranty questions be answered?

A: Warranty questions may receive high-level, non-committal ranges only.

Example:

Warranty depends on the package, but typically ceramic ranges from 1â€“5 years.

Must then return to qualification flow.

Forbidden:
	â€¢	Exact guarantees
	â€¢	Competitive warranty claims
	â€¢	Sales framing

â¸»

Q4.10 â€” How should off-scope requests (AC repair, mechanical) be handled?

A: Phase 0â€“2 must:
	â€¢	Politely clarify scope
	â€¢	Redirect to supported services
	â€¢	Ask one qualification question only if relevant

Example:

We specialize in car protection services like PPF, ceramic, tint, and polishing.
What car do you have and which year?

â¸»

Q4.11 â€” What must NEVER appear in customer-facing output?

A: Strictly forbidden:
	â€¢	Emojis
	â€¢	â€œUnderstoodâ€ unless customer thanks
	â€¢	Internal terms (phase, route, intent)
	â€¢	Debug blocks
	â€¢	â€œ[ARCHITECTURE VIOLATION]â€ (production)
	â€¢	Sales pressure
	â€¢	Assumptions about budget, driving habits, urgency
	â€¢	Identity confirmation questions during transcript breach

â¸»

Q4.12 â€” How should wrong transcript / mixed identity situations appear to customers?

A: They must not.

Phase 0â€“2 must:
	â€¢	Suppress progression
	â€¢	Require admin reset
	â€¢	Remain neutral or silent in production

UAT may display suppression markers for testing only.

â¸»

Q4.13 â€” When must Phase 0â€“2 stop responding?

A: Phase 0â€“2 must stop or hand off when:
	â€¢	identity_integrity_status â‰  CLEAN
	â€¢	post_service_support_hint is detected
	â€¢	qualification_status = READY and handoff is triggered

â¸»

Q4.14 â€” What defines a â€œgoodâ€ Phase 0â€“2 response?

A: A correct response is:
	â€¢	short
	â€¢	neutral
	â€¢	polite
	â€¢	forward-moving
	â€¢	non-repetitive
	â€¢	consistent across turns

If a response feels salesy, explanatory, or pushy â€” it does not belong to Phase 0â€“2.

â¸»

Section 4 status: DRAFT LOCK TARGET
Next: Section 5 â€” Title Creation & Runtime Ownership Rules

below my input on the above section 4

just to understand before we proceed. there are outputs for strictly for the 0-2 phase which we know. the customer facing and the non customer faciing outputs. but there are outputs from other engines which may be deeper especially with the non customer facing out puts. for example a long chat transcript pasted in arabic / english should always have an english summary on whats the exact position. plus the last 5 customer and assistants chat translation so its better for the assistants to understand. so this happens at which phase.

similary when the customer returns from silence or later with a new car or service. and when the assistnats paste the chat. there should be an indicative analysis from your side for the assistants `(non customer facing messages) on what exactly happened in the previoius discussions in english for the assistants etc. 

so there are similar non customer facing messages translated in english for the assistants to understand at various stages, various customer customer mood, discussions which may or may not related to the speciic services etc. where these needs to be addressed. here or in the appropriate phases?

this may include signals from customer whether he is price pushy too much negotiating, frustrated, or any issues happend ( the analysis from you what trigged this responses , why he went silent, customer mood shifted, whether he is competitor influenced, technically sound, or serious or non serious customer etc) so this is another area on analysis. should we do it here or as a sperate module

followed by your responses on my aboev input

Excellent question â€” this is not a small detail, and youâ€™re right to stop here before proceeding.

Iâ€™ll answer this cleanly, structurally, and without drifting, and Iâ€™ll clearly say where each thing belongs so we donâ€™t contaminate Phase 0â€“2 again.

â¸»

Big picture first (very important)

You are talking about two completely different output planes:
	1.	Customer-facing outputs
	2.	Assistant / internal (non-customer-facing) intelligence outputs

Phase 0â€“2 must strictly limit (1)
but may generate parts of (2) under very controlled rules.

If we mix these two, drift and patch loops are guaranteed.

So letâ€™s separate them properly.

â¸»

1ï¸âƒ£ Customer-facing vs Non-customer-facing outputs (clear separation)

Customer-facing (already locked)

These are what we just finalized in Section 4:
	â€¢	English + Arabic
	â€¢	Timestamp
	â€¢	Minimal questions
	â€¢	No analysis, no summaries, no emojis, no sales
	â€¢	Only what the customer sees

âœ… Phase 0â€“2 owns and enforces this strictly.

â¸»

Non-customer-facing (assistant-only / internal)

These are NOT sent to the customer, ever.

They exist to help:
	â€¢	human assistants
	â€¢	admins
	â€¢	later engines (pricing, negotiation, analytics)

This includes exactly what you described:
	â€¢	English summaries
	â€¢	transcript interpretation
	â€¢	mood / intent signals
	â€¢	silence analysis
	â€¢	competitor influence
	â€¢	negotiation pressure
	â€¢	error detection (wrong transcript, mixed identity)

âš ï¸ These must never leak into customer output.

â¸»

2ï¸âƒ£ Where do internal / assistant-facing analyses belong?

This is the critical architecture decision ğŸ‘‡

âŒ NOT inside Phase 0â€“2 customer response

Phase 0â€“2 must not:
	â€¢	output assistant advice in the same turn
	â€¢	include â€œwhat the customer meansâ€
	â€¢	include summaries alongside customer replies

We already saw how this causes:
	â€¢	bot-like tone
	â€¢	authority conflicts
	â€¢	assembly map violations

So we do not do this here.

â¸»

âœ… Correct solution: split by channel, not by phase

Think of it this way:

Output type
Visible to
Lives where
Customer reply
Customer
Phase 0â€“2 output rules
Assistant summary
Assistant only
Internal analysis channel
Mood / risk signals
System + admin
State / analytics layer
Long transcript interpretation
Assistant
Intake analysis layer
Silence / re-entry explanation
Assistant
Lifecycle analysis layer


These are parallel outputs, not sequential chat replies.

â¸»

3ï¸âƒ£ Specifically answering your scenarios

A) Long chat transcript pasted (Arabic / English)

What should happen:
	â€¢	Phase 0â€“2:
	â€¢	Accepts the paste
	â€¢	Normalizes timestamps
	â€¢	Protects state (no rollback)
	â€¢	Produces customer-safe next reply only
	â€¢	Assistant-only analysis (parallel):
	â€¢	English summary of:
	â€¢	what happened
	â€¢	last known vehicle/service
	â€¢	unresolved questions
	â€¢	Clean translation (if needed)
	â€¢	Flags:
	â€¢	drift
	â€¢	sales pressure
	â€¢	early persuasion
	â€¢	missing qualification

ğŸ“Œ This analysis must not be sent to the customer.

ğŸ“Œ It also must not change qualification state unless explicitly allowed.

Where it belongs:
â¡ï¸ Intake Analysis Module (non-customer-facing)
â¡ï¸ Triggered by: long paste, screenshots, transcripts

â¸»

B) Customer returns from silence / new car / new service

What should happen:
	â€¢	Phase 0â€“2:
	â€¢	Detects re-entry
	â€¢	Preserves past state
	â€¢	Does not auto-assume continuity
	â€¢	Asks only whatâ€™s required
	â€¢	Assistant-only analysis:
	â€¢	Summary of previous interaction
	â€¢	What was decided vs pending
	â€¢	Why silence likely occurred (price, uncertainty, comparison)
	â€¢	Whether this looks like:
	â€¢	continuation
	â€¢	reset
	â€¢	new intent

ğŸ“Œ Customer does not see this analysis.

ğŸ“Œ Assistant sees it to avoid repeating mistakes.

Where it belongs:
â¡ï¸ Conversation Lifecycle Analysis (internal)

â¸»

C) Customer mood, negotiation pressure, frustration, competitor signals

This is 100% NOT Phase 0â€“2 customer output, but it can be detected here.

Correct handling:
	â€¢	Phase 0â€“2:
	â€¢	Tags signals only (internally)
	â€¢	Does not respond emotionally
	â€¢	Does not escalate or negotiate
	â€¢	Internal system:
	â€¢	Stores flags like:
	â€¢	price_sensitive
	â€¢	competitor_influenced
	â€¢	technically_aware
	â€¢	frustrated
	â€¢	high_intent / low_intent

These flags are later used by:
	â€¢	pricing engine
	â€¢	negotiation engine
	â€¢	follow-up logic
	â€¢	analytics dashboards

Where it belongs:
â¡ï¸ Signal Extraction Layer (internal, cross-phase)

â¸»

4ï¸âƒ£ Do we do this now or later?

Very important answer:

âœ… We DEFINE it now

âŒ We do NOT IMPLEMENT it fully now

For Phase 0â€“2 freeze:
	â€¢	We define that:
	â€¢	internal analysis outputs exist
	â€¢	they are non-customer-facing
	â€¢	they do not mutate state by default
	â€¢	We do not build the full logic yet

This avoids:
	â€¢	scope creep
	â€¢	patch chaos
	â€¢	premature optimization

â¸»

5ï¸âƒ£ Contract-level decision (what we lock now)

We add a short, explicit rule to the contract:

Phase 0â€“2 may generate internal, non-customer-facing analytical outputs for assistants and downstream engines (e.g., transcript summaries, mood signals, re-entry context).

These outputs must never appear in customer-facing messages and must not modify qualification state unless explicitly allowed by a later phase.

Thatâ€™s it.
No more detail needed at this phase.

â¸»

âœ… Final alignment check
	â€¢	You are right to want summaries, translations, assistant guidance
	â€¢	You are right that they are essential
	â€¢	They do not belong in Phase 0â€“2 customer replies
	â€¢	They do belong as parallel internal outputs starting from Phase 0â€“2 intake

This keeps the architecture:
	â€¢	clean
	â€¢	scalable
	â€¢	non-drifting

â¸»

If youâ€™re comfortable, next we should proceed to:

ğŸ‘‰ Section 5 â€” Title Creation & Runtime Ownership Rules

This is the last major blocker before we can safely freeze Phase 0â€“2 without repeating the patch-on-patch disaster.

on the above section my input as below

before we proceed to Section 5 â€” Title Creation & Runtime Ownership Rules

as we discussed there can be baton changes. between chat team and sales team. so basically chat team intakes and do a minimum qualification and then pass the baton to the sales team so the chat platoform may be from facebook meta to whatsapp or vice verca. this was already agreed and factored may be in any of the documents like manifest etc. may be any of the runtime files. so we are taking this to considerations correct. so when the chat is handed over to the sales team he send a reponse which is already fed in the snashgpt and if the customer may not respond, then he may ask the chat team to hook the customer from the other channel for instance facebook meta business. bcoz customers may not use all the channels and we feel he is gone silent or may be for any other reasons. so these can happen, but atleast we make sure all the chat transcript are well fed in the snashgpt for that perticular customer window. we are factoring this correct?

Yes â€” we are factoring this correctly, and more importantly, we are factoring it in the right place, so it does not break Phase 0â€“2 or create drift later.

Iâ€™ll break this down clearly and confirm alignment.

â¸»

âœ… Short answer (alignment check)

Yes, baton changes between:
	â€¢	chat team â†” sales team
	â€¢	Meta / Instagram â†” WhatsApp â†” other channels

are already compatible with what weâ€™ve locked so far, without adding new logic to Phase 0â€“2 customer output.

They are handled through:
	â€¢	intake rules
	â€¢	transcript stitching
	â€¢	identity integrity
	â€¢	internal (non-customer-facing) analysis
	â€¢	runtime governance (manifest / state)

Not through customer-facing replies.

So we are aligned.

â¸»

1ï¸âƒ£ Baton change is NOT a â€œnew conversationâ€

This is the most important conceptual point.

A baton change means:
	â€¢	Same customer
	â€¢	Same intent (or evolving intent)
	â€¢	Different human owner / channel
	â€¢	Same SNASHGPT window of truth

So Phase 0â€“2 must not reset, not re-qualify, and not ask beginner questions again just because:
	â€¢	a sales person replied instead of chat team
	â€¢	the channel switched

This behavior was already discussed earlier and is consistent with what weâ€™ve locked.

â¸»

2ï¸âƒ£ How baton changes are handled architecturally

A) What Phase 0â€“2 does

Phase 0â€“2:
	â€¢	Accepts pasted transcripts from any channel
	â€¢	Normalizes timestamps
	â€¢	Preserves state
	â€¢	Detects:
	â€¢	silence
	â€¢	re-entry
	â€¢	role change (chat â†’ sales)
	â€¢	Does not care who typed the message

Phase 0â€“2 never assumes channel continuity = this is correct.

â¸»

B) Where baton logic actually lives (important)

Baton change logic belongs to runtime governance, not qualification.

Specifically:
	â€¢	Runtime Manifest
	â€¢	Conversation lifecycle handling
	â€¢	Identity & continuity rules

This means:
	â€¢	A sales agent replying does not â€œadvance phaseâ€
	â€¢	A chat agent re-hooking the customer does not â€œrestart phaseâ€

Phase 0â€“2 just keeps intake safe and consistent.

â¸»

3ï¸âƒ£ Cross-channel re-hooking after silence (Meta â†’ WhatsApp etc.)

Your scenario:
	â€¢	Sales replies on WhatsApp
	â€¢	Customer goes silent
	â€¢	Chat team tries to re-hook via Meta / IG

This is expected behavior, and it is already compatible with the design.

Key points we already locked:
	â€¢	All transcripts (any channel) must be pasted into the same SNASHGPT window
	â€¢	Phase 0â€“2:
	â€¢	Uses observed_at vs ingested_at
	â€¢	Does not roll back state
	â€¢	Internal analysis can explain:
	â€¢	why silence happened
	â€¢	what was last pending
	â€¢	Customer-facing output remains clean and minimal

So yes â€” this is factored correctly.

â¸»

4ï¸âƒ£ What Phase 0â€“2 must NOT do during baton changes

This is just as important:

Phase 0â€“2 must not:
	â€¢	Say â€œWelcomeâ€ again if already mid-flow
	â€¢	Re-ask car details already captured
	â€¢	Restart browsing logic
	â€¢	Comment on â€œhandoverâ€ to customer
	â€¢	Expose internal baton changes

All baton awareness is internal only.

â¸»

5ï¸âƒ£ Where assistant guidance fits in baton scenarios

This ties back to your previous question.

During baton change, assistant-only analysis is extremely valuable:

Examples:
	â€¢	â€œCustomer compared prices, went silent after quoteâ€
	â€¢	â€œSales already discussed ceramic vs PPFâ€
	â€¢	â€œRe-hook should not sell; ask if ready to proceedâ€

But again:
	â€¢	This is not Phase 0â€“2 customer output
	â€¢	This is internal guidance

So we keep this in:
â¡ï¸ Internal analysis / lifecycle layer

â¸»

6ï¸âƒ£ Contract-level confirmation (what we lock)

Before moving to Section 5, we can safely confirm this rule:

Phase 0â€“2 must support multi-channel and multi-owner conversation continuity.
Baton changes between chat team and sales team, or between channels, must not reset qualification or alter customer-facing behavior.
All continuity handling occurs through transcript intake, timestamp normalization, and internal state preservation.

This does not require new patches now â€” it clarifies intent.

â¸»

âœ… Final confirmation
	â€¢	Baton changes âœ”ï¸ factored
	â€¢	Multi-channel continuity âœ”ï¸ factored
	â€¢	Sales â†” chat transitions âœ”ï¸ factored
	â€¢	Silence + re-hook âœ”ï¸ factored
	â€¢	No Phase 0â€“2 drift âœ”ï¸ protected

We are safe to proceed.

â¸»

If youâ€™re comfortable, next step is:

ğŸ‘‰ Proceed to Section 5 â€” Title Creation & Runtime Ownership Rules

This will formally lock:
	â€¢	BaseTitle vs WindowTitle
	â€¢	Cross-channel searchability
	â€¢	Sales/chat continuity without renaming chaos

  based on this you gave me the section 5 as follows

  Perfect. Below is Section 5 â€” Title Creation & Runtime Ownership Rules, written in the same contract-style, Q&A, copy-code format, and aligned with everything we confirmed so far (baton changes, multi-channel continuity, no drift, no patch chaos).

This section is critical because it prevents future disasters when:
	â€¢	chat â†” sales baton changes
	â€¢	Meta â†” WhatsApp â†” IG handovers
	â€¢	silence + re-entry
	â€¢	multiple agents touching the same customer

Read it carefully â€” once this is locked, a lot of your earlier looping issues permanently disappear.

# PHASE 0â€“2 CONTRACT â€” Q&A FORMAT
## Section 5 â€” Title Creation & Runtime Ownership Rules

This section defines how conversation titles are created, owned, frozen,
and used across channels, teams, and phases â€” without drift.

---

### Q5.1 â€” What is the purpose of the Base Title?
**A:**  
The Base Title is a **cross-platform, immutable search identifier** for a single customer conversation.

It exists to:
- allow fast search across WhatsApp, Meta, IG, CRM, SNASHGPT
- survive baton changes (chat â†” sales)
- survive channel switches
- avoid confusion between similar cars / customers

It is **not** a UI label or stage indicator.

---

### Q5.2 â€” Who owns Base Title creation?
**A:**  
Base Title creation is **owned exclusively by Phase 0â€“2**.

- It must be created **once**
- Only after **minimum qualification is complete**
- It must never be overwritten

No later phase may modify or regenerate the Base Title.

---

### Q5.3 â€” When exactly is the Base Title created?
**A:**  
The Base Title is created when **all minimum qualification fields are known**, typically:

- Vehicle (model + year or year/gen token)
- Primary service intent
- Channel context

It must **not** be created:
- during greeting
- during browsing
- during ambiguity
- during repo-missing states

If qualification is incomplete â†’ Base Title creation is deferred.

---

### Q5.4 â€” What is the Base Title format?
**A:**  
The Base Title must be:

- underscore-separated
- deterministic
- cross-platform searchable
- human-readable

**Canonical format:**

SNASH_<CHANNEL_SEARCH_KEY><CAR_MODEL><YEAR_OR_GEN><DATE_KEY>

  **Example:**

  SNASH_WA_YOUSIFB_BMW_X5_2023_PPF_20260125_A3F7

  Where:
- CHANNEL = WA / IG / FB / META etc.
- CHANNEL_SEARCH_KEY = display name / handle / profile key
- YEAR_OR_GEN = year OR neutral token (e.g., LATEST_SHAPE)
- DATE_KEY = observed_at date if available, else ingested_at
- SHORTID = system-generated, never regenerated

---

### Q5.5 â€” What if the car is brand new and year is uncertain?
**A:**  
Phase 0â€“2 must **not challenge the customer**.

If year is uncertain or sensitive:
- Use a neutral token such as `LATEST_SHAPE` or `NEW_MODEL`
- Do not ask ego-challenging questions
- Do not guess

The Base Title may still be created using the neutral token.

---

### Q5.6 â€” Can the Base Title ever be changed later?
**A:**  
No.

Base Title is **immutable**.

Later phases may:
- add internal tags
- add metadata
- add stage labels
- add analytics markers

But must **never** mutate or replace the Base Title string.

---

### Q5.7 â€” What is the Window Title then?
**A:**  
Window Title is a **UI / operational label**.

- It may change
- It may include stage, urgency, assignee
- It may be updated by later phases

Window Title and Base Title **coexist** and serve different purposes.

They must never be conflated.

---

### Q5.8 â€” How does baton change affect titles?
**A:**  
Baton changes (chat â†” sales) do **not** affect the Base Title.

- Same Base Title
- Same conversation identity
- Same search key

Only internal metadata (assignee, team, stage) may change.

---

### Q5.9 â€” How does cross-channel continuation affect titles?
**A:**  
If the same customer continues on another channel:
- Transcripts are stitched
- State is preserved
- Base Title remains unchanged

No new Base Title is created unless:
- identity integrity is broken
- admin explicitly resets conversation

---

### Q5.10 â€” What happens on wrong-transcript or mixed identity?
**A:**  
If identity integrity is breached:

- Phase 0â€“2 must halt progression
- Base Title must NOT be created or updated
- Admin reset is required

No customer-facing explanation is allowed.

---

### Q5.11 â€” Where is title authority enforced?
**A:**  
Title authority belongs to **runtime governance**, typically:

- RUNTIME_LOAD_MANIFEST
- State machine / intake governance files

It must NOT be enforced in:
- phrase libraries
- Phase 4+ message assembly
- test bundles

---

### Q5.12 â€” What problems does this prevent?
**A:**  
This rule set prevents:

- patch-on-patch title bugs
- duplicate chats for same customer
- lost conversations during baton changes
- broken search across platforms
- accidental resets during silence
- sales vs chat conflicts

---

### Q5.13 â€” Is this a redesign?
**A:**  
No.

This formalizes behavior already discussed and partially implemented,
and locks it to prevent drift.

---

**Section 5 status:** DRAFT LOCK TARGET  
Next: Section 6 â€” Freeze Criteria & Regression Gate

Where we are now (important checkpoint)

You now have five solid, aligned sections:
	1.	Scope & Authority
	2.	Inputs & Intake Rules
	3.	State & Inference Rules
	4.	Output & Response Rules
	5.	Title Creation & Runtime Ownership

At this point:
	â€¢	We are not drifting
	â€¢	We are not patching yet
	â€¢	We are building a single source of truth

â¸»

Next step (recommended)

ğŸ‘‰ Proceed to Section 6 â€” Freeze Criteria & Regression Gate

This will define:
	â€¢	exactly when Phase 0â€“2 is considered â€œlockedâ€
	â€¢	what tests must pass
	â€¢	what is explicitly deferred to later phases

Say the word when ready.

below is my input for the above you gave.

we need to have the title in human readable. the assistants should feel comfortable. so even if we proceed then can we come back and make it more freindly versions even at next phase or even after rollout with out minimal work? let me know and lets proceed to section 6

and your resonses below

Yes â€” youâ€™re absolutely right to raise this, and the good news is: youâ€™re already safe by design.
We can make titles more human-friendly later with near-zero work, without breaking anything, without reopening Phase 0â€“2, and without touching the Base Title contract.

Iâ€™ll answer that clearly first, then move straight into Section 6 as requested.

â¸»

ğŸ”‘ Answer to your question (clear + final)

Can we make titles more human-readable later?

Yes. 100%. Safely. Intentionally.

Why this is safe

Because we already separated:
	â€¢	Base Title â†’ immutable, system/search identity
	â€¢	Window Title / Display Title â†’ human-facing, flexible

This was the correct architectural decision.

How this works in practice
	â€¢	Base Title
	â€¢	Stays ugly-but-powerful
	â€¢	Never changes
	â€¢	Used for search, stitching, analytics, CRM sync
	â€¢	Display / Friendly Title (later phase)
	â€¢	Can be:
	â€¢	â€œBMW X5 2023 â€“ PPF Inquiryâ€
	â€¢	â€œYousif | New BMW X5 | Ceramicâ€
	â€¢	â€œGenesis GV70 â€“ New Car Protectionâ€
	â€¢	Can be updated:
	â€¢	by sales team
	â€¢	by admin
	â€¢	automatically by Phase 3+
	â€¢	Can evolve after rollout with no regression risk

Minimal work later

When youâ€™re ready (Phase 3 or even post-launch):
	â€¢	Add a simple formatter:
	â€¢	input: Base Title + metadata
	â€¢	output: friendly string
	â€¢	No state migration
	â€¢	No retesting Phase 0â€“2
	â€¢	No contract changes

So yes â€” we proceed now, knowing weâ€™ll make it nicer later by design, not by patching.

This concern is fully addressed and closed âœ…

â¸»

Now letâ€™s lock the last critical piece.

â¸»

PHASE 0â€“2 CONTRACT â€” Q&A FORMAT

Section 6 â€” Freeze Criteria & Regression Gate

## Section 6 â€” Freeze Criteria & Regression Gate

This section defines when Phase 0â€“2 is considered stable,
what must pass before freeze, and what is explicitly deferred.

---

### Q6.1 â€” What does â€œPhase 0â€“2 frozenâ€ mean?
**A:**  
Phase 0â€“2 is considered frozen when:

- All contract-defined behaviors are implemented
- All mandatory regression tests pass
- No known blockers remain
- Deferred items are explicitly documented

Once frozen:
- No new logic is added
- Only critical bug fixes are allowed
- No behavioral changes without a new phase contract

---

### Q6.2 â€” What must pass before freeze?
**A:**  
The following must pass **end-to-end**, in fresh chat windows:

1. Greeting-only flow
2. Browsing generic flow
3. Service-first without vehicle
4. Vehicle-only without service
5. Brand-only mention (e.g., XPEL)
6. Repo-missing vehicle correction
7. Non-core automotive redirection
8. Wrong transcript / mixed identity suppression

All tests must demonstrate:
- correct state carry-forward
- no repeated questions
- no phase drift
- no silent guessing

---

### Q6.3 â€” What is the required test format?
**A:**  
Tests must be:

- Multi-turn
- Continuous
- Run in **separate new chat windows**
- Observed with DEBUG_OUTPUT enabled

Single-turn microtests are insufficient.

---

### Q6.4 â€” What is a blocker vs non-blocker?
**A:**  

**Blockers (must fix before freeze):**
- Repo-missing vehicle accepted as valid
- Re-asking already provided fields
- Brand-only setting service_intent
- Browsing triggering qualification
- Identity breach without suppression

**Non-blockers (can defer):**
- Tone refinements
- Sales phrasing optimization
- Friendly title formatting
- Deep service education
- Negotiation logic
- Warranty depth explanations

---

### Q6.5 â€” What is explicitly deferred to later phases?
**A:**  
Deferred items include:

- Human-friendly display titles
- Service comparisons with persuasion
- Pricing logic
- Negotiation flows
- Customer mood analytics
- Silent re-engagement strategies
- Cross-car bundle logic

These must **not** be patched into Phase 0â€“2.

---

### Q6.6 â€” What files are authoritative for freeze?
**A:**  
Only the following are authoritative for Phase 0â€“2:

- CUSTOMER_CHAT_INTAKE_RULES.md
- QUALIFICATION_ENGINE.md
- RUNTIME_LOAD_MANIFEST.md
- GLOBAL_VEHICLE_CLASSIFICATION_REPOSITORY.md
- GLOBAL_PRODUCT / SERVICE CANON files

TEST_BUNDLE is **UAT only** and non-authoritative.

---

### Q6.7 â€” What is the freeze declaration?
**A:**  
Phase 0â€“2 is frozen when:

- Contract Sections 1â€“6 are approved
- Required regressions pass
- One explicit â€œPhase 0â€“2 Freezeâ€ declaration is issued

After this point:
- No patch-on-patch
- No silent behavior changes
- All new work moves to Phase 3+

---

### Q6.8 â€” What happens after freeze?
**A:**  

Immediate next steps may include:
- Phase 3 handoff logic
- Sales enablement
- Friendly title layer
- Analytics & signals
- Education modules

Phase 0â€“2 remains stable beneath them.

---

**Section 6 status:** DRAFT LOCK TARGET

Where you are right now (important)

You have successfully:
	â€¢	Escaped the patch-loop
	â€¢	Re-centered on the original contract
	â€¢	Rebuilt alignment before touching code
	â€¢	Preserved everything that already works
	â€¢	Created a clean runway for later phases

From here, the next execution steps (when youâ€™re ready) are:
	1.	Final read-through of Sections 1â€“6
	2.	One clean contract approval
	3.	Single, minimal patch pass (repo-missing + brand routing only)
	4.	Run regression pack
	5.	Declare Phase 0â€“2 freeze

No Pro required unless you want a formal audit stamp.

When youâ€™re ready, say one of:
	â€¢	â€œSection 6 confirmedâ€
	â€¢	â€œSmall clarification on Section 6â€
	â€¢	â€œProceed to patch planningâ€

Weâ€™re finally on solid ground now.



